---
const { frontmatter } = Astro.props;
import ContactForm from "../components/ContactForm.astro";
import Layout from "../layouts/Layout.astro";
import BreadcrumbSchema from "../components/BreadcrumbSchema.astro";
import { getLangFromUrl } from "../i18n/utils";

import {
  FacebookShareButton,
  LinkedInShareButton,
  RedditShareButton,
  TwitterShareButton,
  WhatsAppShareButton,
  SocialShare,
} from "astro-social-share";

const BUTTONS = [
  FacebookShareButton,
  LinkedInShareButton,
  RedditShareButton,
  TwitterShareButton,
  WhatsAppShareButton,
];

const lang = getLangFromUrl(Astro.url);
const isEnglish = lang === "en";
const ogImage = frontmatter.image?.url ? (frontmatter.image.url.startsWith("http") ? frontmatter.image.url : `https://www.ignathedev.com${frontmatter.image.url}`) : "https://www.ignathedev.com/img/profile_picture_og-upscaled.jpg";
const url = `https://www.ignathedev.com${Astro.url.pathname}`;
const blogUrl = isEnglish ? "https://www.ignathedev.com/en/blog" : "https://www.ignathedev.com/blog";
const homeUrl = isEnglish ? "https://www.ignathedev.com/en" : "https://www.ignathedev.com";
const locale = isEnglish ? "en_US" : "es_ES";
const inLanguage = isEnglish ? "en-US" : "es-ES";

// Parse publish_date (format: DD/MM/YYYY)
const parseDate = (dateStr: string) => {
  const parts = dateStr.split("/");
  return parts.length === 3 ? new Date(`${parts[2]}-${parts[1]}-${parts[0]}`).toISOString() : new Date().toISOString();
};
const publishedTime = parseDate(frontmatter.publish_date || "");
---

<Layout
  title={frontmatter.title}
  description={frontmatter.description}
  pageType="article"
  articleData={{
    publishedTime,
    modifiedTime: publishedTime,
    author: frontmatter.author || "Ignacio Amat Urbina",
    tags: frontmatter.tags || [],
  }}
  openGraph={{
    url: url,
    title: frontmatter.title,
    type: "article",
    description: frontmatter.description,
    images: [{
      url: ogImage,
      width: 1200,
      height: 630,
      alt: frontmatter.image?.alt || frontmatter.title,
      type: "image/jpeg",
    }],
    site_name: isEnglish ? "Ignacio Amat - Full Stack Developer" : "Ignacio Amat - Desarrollador Full Stack",
    locale,
  }}
  twitter={{
    handle: "@ignathedev",
    site: "@ignathedev",
    cardType: "summary_large_image",
  }}
>
  <BreadcrumbSchema
    items={[{ name: "Blog", item: blogUrl }, { name: frontmatter.title, item: url }]}
    homeUrl={homeUrl}
    homeName={isEnglish ? "Home" : "Inicio"}
  />
  
  <main class="flex flex-col items-center min-screen">
    <!--
// v0 by Vercel.
// https://v0.dev/t/fUIoAq9FjJn
-->

    <article class="prose prose-gray max-w-3xl mx-auto dark:prose-invert py-12">
      <div class="space-y-4 not-prose">
        <h1 class="text-3xl lg:text-5xl font-extrabold tracking-tight">
          {frontmatter.title}
        </h1>
        <div class="flex items-center gap-4 text-muted-foreground">
          <div class="flex items-center gap-2">
            <span
              class="relative flex shrink-0 overflow-hidden rounded-full w-8 h-8 border"
            >
              <img
                class="aspect-square h-full w-full"
                src="/img/optimized/profile_picture.webp"
                width="32"
                height="32"
                loading="lazy"
                alt="Author profile picture"
              />
            </span>
            <span class="font-medium">{frontmatter.author}</span>
          </div>
          <span>•</span>
          <time datetime={publishedTime}>{frontmatter.publish_date}</time>
        </div>
      </div>
      <div class="flex flex-wrap gap-2 py-5">
        {
          frontmatter.tags.map((tag: string) => (
            <div
              class="inline-flex w-fit items-center whitespace-nowrap rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 text-foreground"
              data-v0-t="badge"
            >
              {tag}
            </div>
          ))
        }
      </div>
      <div>
        <SocialShare
          buttons={BUTTONS}
          description={frontmatter.description}
          title={frontmatter.title}
        />
        <slot name="astro-social-share-css">
          <style is:global>
            .astro-social-share {
              margin: 20px 0px;
              height: 24px;
              display: inline-flex;
            }
            .astro-social-share a {
              text-decoration: none;
              margin-right: 10px;
              color: #fff;
            }
            .astro-social-share svg {
              height: 24px;
              fill: #fff;
            }
          </style>
        </slot>
      </div>
      <img
        src={frontmatter.image?.url}
        alt={frontmatter.image?.alt || frontmatter.title}
        width="1250"
        height="600"
        class="aspect-video overflow-hidden rounded-lg object-fill mb-4"
        loading="eager"
      />
      {frontmatter.image?.alt && (
        <p class="text-center text-sm opacity-50 pb-8">{frontmatter.image.alt}</p>
      )}
      <slot />
      <div class="text-center mb-12 mt-12">
        <h2 class="text-2xl font-bold mb-4">{isEnglish ? "Would you like to contact me?" : "¿Te gustaría contactarme?"}</h2>
        <p class="text-gray-600 dark:text-gray-400 mb-6">{isEnglish ? "If you have any questions or comments about this article, feel free to reach out using the form below." : "Si tienes alguna pregunta o comentario sobre este artículo, no dudes en escribirme usando el formulario a continuación."}</p>
      </div>
      <ContactForm id="contact" />
    </article>
  </main>
</Layout>

<style>
  article p + h2 {
    font-size: 1.5em;
    font-weight: bold;
    margin-top: 1.5em;
  }

  article h2 + h1 {
    font-size: 2em;
    font-weight: bold;
    margin-top: 1.5em;
  }

  article {
    text-wrap: pretty;
  }

  article h3 {
    font-weight: bold;
    font-size: 1.5em;
    margin-top: 1.5em;
  }

  article p {
    margin: 10px 0;
    line-height: 1.7;
  }

  article ul,
  article ol {
    list-style-type: circle;
    margin: 10px 0 10px 20px;
  }

  article li h4 {
    /* add soft light font */
    font-weight: lighter;
    font-style: italic;
  }

  article blockquote {
    border-left: 4px solid #ddd;
    padding-left: 15px;
    color: #666;
    margin: 20px 0;
    font-style: italic;
  }

  article code {
    background-color: #f5f5f5;
    padding: 2px 4px;
    border-radius: 4px;
    font-family: "Courier New", Courier, monospace;
  }

  article pre {
    background-color: #f5f5f5;
    padding: 10px;
    border-radius: 4px;
    overflow-x: auto;
  }
</style>

<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": frontmatter.title,
  "description": frontmatter.description,
  "image": ogImage,
  "datePublished": publishedTime,
  "dateModified": publishedTime,
  "author": {
    "@type": "Person",
    "@id": "https://www.ignathedev.com/#person",
    "name": frontmatter.author || "Ignacio Amat Urbina",
    "url": "https://www.ignathedev.com"
  },
  "publisher": {
    "@type": "Person",
    "@id": "https://www.ignathedev.com/#person",
    "name": "Ignacio Amat Urbina",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.ignathedev.com/img/optimized/profile_picture.webp"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": url
  },
  "keywords": (frontmatter.tags || []).join(", "),
  "articleSection": isEnglish ? "Web Development" : "Desarrollo Web",
  "inLanguage": inLanguage,
  "isAccessibleForFree": true
})}></script>

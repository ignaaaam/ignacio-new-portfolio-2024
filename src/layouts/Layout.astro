---
import Header from "../components/Header.astro";
import HeaderEnglish from "../pages/en/Header.astro";
import Footer from "../components/Footer.astro";
import FooterEnglish from "../pages/en/Footer.astro";
import "@fontsource-variable/onest";
import "@fontsource-variable/overpass";
import { getLangFromUrl } from "../i18n/utils";
import { AstroSeo } from "@astrolib/seo";
import SpeedInsights from "@vercel/speed-insights/astro";

interface Props {
  title: string;
  description: string;
  canonical?: string;
  robots?: string;
  pageType?: "website" | "profile" | "article";
  articleData?: {
    publishedTime?: string;
    modifiedTime?: string;
    author?: string;
    tags?: string[];
  };
  openGraph?: {
    url: string;
    title: string;
    type: string;
    description: string;
    images: Array<{
      url: string;
      width: number;
      height: number;
      alt: string;
      type: string;
    }>;
    site_name: string;
    locale: string;
  };
  twitter?: {
    handle: string;
    site: string;
    cardType: string;
  };
}

const {
  title,
  description,
  canonical,
  pageType = "website",
  articleData,
  openGraph: customOpenGraph,
  robots: customRobots,
} = Astro.props;

const lang = getLangFromUrl(Astro.url);
const ogImage = "https://www.ignathedev.com/img/profile_picture_og-upscaled.jpg";
const siteName = lang === "es" ? "Ignacio Amat Urbina - Desarrollador Web Full Stack | Experto PHP & Laravel" : "Ignacio Amat Urbina - Full Stack Web Developer | PHP & Laravel Expert";

// Professional profile data for SEO
const professionalProfile = {
  name: "Ignacio Amat Urbina",
  givenName: "Ignacio",
  familyName: "Amat Urbina",
  jobTitle: lang === "es" ? "Desarrollador Web Full Stack" : "Full Stack Web Developer",
  alternateName: ["Igna", "ignathedev"],
  email: "ignacioamat@ignathedev.com",
  telephone: "+34",
  birthDate: "1997",
  nationality: "Spanish",
  address: {
    city: "Barcelona",
    region: "Catalonia",
    country: "Spain",
    countryCode: "ES",
  },
  yearsOfExperience: 5,
  availableForHire: true,
  workLocation: ["Remote", "Barcelona", "Spain"],
  languages: ["Spanish", "English", "Catalan"],
  skills: {
    programming: ["PHP", "JavaScript", "TypeScript", "SQL", "HTML", "CSS", "SCSS"],
    frameworks: ["Laravel", "Vue.js", "React", "Astro", "TailwindCSS", "Livewire", "Alpine.js"],
    databases: ["MySQL", "PostgreSQL", "MongoDB", "Redis"],
    tools: ["Git", "Docker", "Linux", "Nginx", "Apache", "AWS", "DigitalOcean"],
    methodologies: ["Agile", "Scrum", "TDD", "CI/CD", "REST API Design"],
  },
  certifications: ["Laravel Certified Developer", "Vue.js Developer"],
  socialProfiles: {
    linkedin: "https://www.linkedin.com/in/ignacio-amat-urbina-789244223",
    github: "https://github.com/ignaaaam",
    behance: "https://www.behance.net/ignathedev",
    stackoverflow: "https://stackoverflow.com/users/13370846/ignacio-amat-urbina",
    laracasts: "https://laracasts.com/@ignacio-amat-urbina",
  },
};

const defaultTitle = lang === "es" ? "Desarrollador Web Full Stack" : "Full Stack Web Developer";
const pageTitle = title || defaultTitle;
// Only add suffix when using default title to avoid duplication; keep 50-60 chars for SERP
const titleSuffix = !title || title === defaultTitle ? (lang === "es" ? " | PHP Laravel Vue.js" : " | PHP Laravel Vue.js") : "";
const fullTitle = `${pageTitle}${titleSuffix}`;
const metaTitle = fullTitle.length > 60 ? fullTitle.substring(0, 57) + "..." : fullTitle;

// SEO-optimized descriptions: 150-160 chars, primary keyword, CTA
const rawDescription =
  description ||
  (lang === "es"
    ? "Desarrollador web full stack especializado en PHP, Laravel y Vue.js. Disponible para proyectos remotos y contratación internacional."
    : "Full stack web developer specialized in PHP, Laravel, and Vue.js. Available for remote projects and international hiring.");
// Optimize description length: 150-160 characters for best SEO
const metaDescription = rawDescription.length > 160 ? rawDescription.substring(0, 157) + "..." : rawDescription;

// Current page path for breadcrumbs
const currentPath = Astro.url.pathname;
const isHomePage = currentPath === "/" || currentPath === "/en" || currentPath === "/en/";
const isBlogPage = currentPath.includes("/blog");
const canonicalUrl = canonical ?? `https://www.ignathedev.com${currentPath}`;
const spanishPath = currentPath.replace(/^\/en/, "") || "/";
const normalizedSpanishPath = spanishPath.endsWith("/") && spanishPath !== "/" ? spanishPath.slice(0, -1) : spanishPath;
const spanishUrl = `https://www.ignathedev.com${normalizedSpanishPath || "/"}`;
const englishUrl = normalizedSpanishPath === "/" ? "https://www.ignathedev.com/en" : `https://www.ignathedev.com/en${normalizedSpanishPath}`;
---

<!doctype html>
<html lang={lang}>
  <head>
    <!-- Google tag (gtag.js) -->
    <script
      type="text/partytown"
      defer
      src="https://www.googletagmanager.com/gtag/js?id=G-VZQ07QHFLN"
      is:inline
    ></script>
    <script type="text/partytown" is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-VZQ07QHFLN");
    </script>
    <!-- SEO Meta Tags with AstroSEO -->
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />

    <!-- Direct meta tags instead of using additionalMetaTags -->
    <meta
      name="description"
      content={metaDescription}
    />
    <meta
      name="author"
      content="Ignacio Amat Urbina"
    />
    <meta
      name="robots"
      content={customRobots ?? "index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"}
    />
    <meta
      name="theme-color"
      content="#0a0a0a"
    />
    <meta
      name="format-detection"
      content="telephone=no"
    />
    <meta
      name="apple-mobile-web-app-title"
      content="Ignacio Amat - Developer"
    />

    <script is:inline>
      function speedInsightsBeforeSend(data) {
        return data;
      }
    </script>
    <SpeedInsights />

    <AstroSeo
      title={metaTitle}
      description={metaDescription}
      canonical={canonicalUrl}
      openGraph={customOpenGraph ?? {
        url: canonicalUrl,
        title: metaTitle,
        type: pageType === "profile" ? "profile" : pageType === "article" ? "article" : "website",
        description: metaDescription,
        images: [
          {
            url: ogImage,
            width: 1200,
            height: 630,
            alt: lang === "es" ? "Foto de perfil de Ignacio Amat Urbina - Desarrollador Web Full Stack" : "Profile picture of Ignacio Amat Urbina - Full Stack Web Developer",
            type: "image/jpeg",
          },
        ],
        site_name: siteName,
        locale: lang === "es" ? "es_ES" : "en_US",
      }}
      twitter={{
        handle: "@ignathedev",
        site: "@ignathedev",
        cardType: "summary_large_image",
      }}
    />

    <!-- Enhanced Open Graph for professional profiles -->
    <meta
      property="og:locale:alternate"
      content={lang === "es" ? "en_US" : "es_ES"}
    />
    <meta
      property="profile:first_name"
      content={professionalProfile.givenName}
    />
    <meta
      property="profile:last_name"
      content={professionalProfile.familyName}
    />
    <meta
      property="profile:username"
      content="ignathedev"
    />

    <!-- Article-specific meta tags for blog posts -->
    {articleData && pageType === "article" && (
      <>
        {articleData.publishedTime && (
          <meta property="article:published_time" content={articleData.publishedTime} />
        )}
        {articleData.modifiedTime && (
          <meta property="article:modified_time" content={articleData.modifiedTime} />
        )}
        {articleData.author && (
          <meta property="article:author" content={articleData.author} />
        )}
        {articleData.tags?.map((tag) => (
          <meta property="article:tag" content={tag} />
        ))}
      </>
    )}

    <!-- LinkedIn specific meta tags -->
    <meta
      name="linkedin:owner"
      content="Ignacio Amat Urbina"
    />

    <!-- Enhanced Twitter Cards -->
    <meta
      name="twitter:label1"
      content={lang === "es" ? "Profesión" : "Profession"}
    />
    <meta
      name="twitter:data1"
      content={professionalProfile.jobTitle}
    />
    <meta
      name="twitter:label2"
      content={lang === "es" ? "Ubicación" : "Location"}
    />
    <meta
      name="twitter:data2"
      content={`${professionalProfile.address.city}, ${professionalProfile.address.country}`}
    />

    <script
      defer
      is:inline
      src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.0/flowbite.min.js"
    ></script>

    <!-- Enhanced dark mode initialization script -->
    <script is:inline>
      function initializeTheme() {
        if (localStorage.getItem("color-theme") === "dark" || (!("color-theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
          document.documentElement.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
        }
      }

      // Initialize theme immediately
      initializeTheme();

      // Re-initialize on page transitions
      document.addEventListener("astro:after-swap", initializeTheme);
    </script>

    <!-- Facebook Meta Tags -->
    <!-- <meta property="og:url" content="https://www.ignathedev.com/"> -->
    <!-- <meta property="og:type" content="website"> -->
    <!-- <meta property="og:title" content={title}> -->
    <!-- <meta property="og:description" content={description}> -->
    <!-- <meta property="og:image" content="https://www.ignathedev.com/img/profile_picture_og-upscaled.jpg"> -->

    <!-- Twitter Meta Tags -->
    <!-- <meta name="twitter:card" content="summary_large_image"> -->
    <!-- <meta property="twitter:domain" content="ignathedev.com"> -->
    <!-- <meta property="twitter:url" content="https://www.ignathedev.com/"> -->
    <!-- <meta name="twitter:title" content={title}> -->
    <!-- <meta name="twitter:description" content={description}> -->
    <!-- <meta name="twitter:image" content="https://www.ignathedev.com/img/profile_picture_og-upscaled.jpg"> -->

    <!-- Meta Tags Generated via https://www.opengraph.xyz -->
    <!-- <meta property="og:site_name" content="Ignacio Amat Urbina - Desarrollador Web Full Stack & Laravel Expert"> -->

    <!-- Locale -->
    <!-- <meta property="og:locale" content="es_ES"> -->

    <!-- Keywords -->
    <!-- <meta name="keywords" content={t('keywords')}> -->

    <!-- Author -->
    <!-- <meta property="og:author" content="Ignacio Amat Urbina"> -->

    <!-- Enhanced Schema.org structured data for Portfolio/CV -->
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@graph": [
          {
            "@type": "WebSite",
            "@id": "https://www.ignathedev.com/#website",
            url: "https://www.ignathedev.com",
            name: siteName,
            description:
              lang === "es"
                ? "Portfolio y curriculum de Ignacio Amat Urbina - Desarrollador Web Full Stack especializado en PHP, Laravel y Vue.js"
                : "Portfolio and resume of Ignacio Amat Urbina - Full Stack Web Developer specialized in PHP, Laravel and Vue.js",
            inLanguage: ["es-ES", "en-US"],
            publisher: {
              "@id": "https://www.ignathedev.com/#person",
            },
          },
          {
            "@type": "ProfilePage",
            "@id": `https://www.ignathedev.com${currentPath}#profilepage`,
            url: `https://www.ignathedev.com${currentPath}`,
            name: metaTitle,
            description: metaDescription,
            inLanguage: lang === "es" ? "es-ES" : "en-US",
            isPartOf: {
              "@id": "https://www.ignathedev.com/#website",
            },
            about: {
              "@id": "https://www.ignathedev.com/#person",
            },
            mainEntity: {
              "@id": "https://www.ignathedev.com/#person",
            },
          },
          {
            "@type": "Person",
            "@id": "https://www.ignathedev.com/#person",
            name: professionalProfile.name,
            givenName: professionalProfile.givenName,
            familyName: professionalProfile.familyName,
            alternateName: professionalProfile.alternateName,
            jobTitle: professionalProfile.jobTitle,
            description:
              lang === "es"
                ? `Desarrollador Web Full Stack con +${professionalProfile.yearsOfExperience} años de experiencia. Experto en PHP, Laravel y Vue.js. Disponible para proyectos remotos e internacionales.`
                : `Full Stack Web Developer with +${professionalProfile.yearsOfExperience} years of experience. Expert in PHP, Laravel, and Vue.js. Available for remote and international projects.`,
            image: {
              "@type": "ImageObject",
              url: ogImage,
              width: 1200,
              height: 630,
            },
            email: `mailto:${professionalProfile.email}`,
            url: "https://www.ignathedev.com",
            sameAs: Object.values(professionalProfile.socialProfiles),
            nationality: {
              "@type": "Country",
              name: professionalProfile.nationality,
            },
            address: {
              "@type": "PostalAddress",
              addressLocality: professionalProfile.address.city,
              addressRegion: professionalProfile.address.region,
              addressCountry: professionalProfile.address.countryCode,
            },
            knowsLanguage: professionalProfile.languages.map((lang) => ({
              "@type": "Language",
              name: lang,
            })),
            knowsAbout: [...professionalProfile.skills.programming, ...professionalProfile.skills.frameworks, ...professionalProfile.skills.databases, ...professionalProfile.skills.tools, ...professionalProfile.skills.methodologies],
            hasCredential: professionalProfile.certifications.map((cert) => ({
              "@type": "EducationalOccupationalCredential",
              name: cert,
            })),
            hasOccupation: {
              "@type": "Occupation",
              name: professionalProfile.jobTitle,
              occupationLocation: {
                "@type": "City",
                name: professionalProfile.address.city,
              },
              skills: [...professionalProfile.skills.programming, ...professionalProfile.skills.frameworks].join(", "),
            },
            seeks: {
              "@type": "Demand",
              name: lang === "es" ? "Proyectos de desarrollo web" : "Web development projects",
            },
            worksFor: {
              "@type": "Organization",
              name: lang === "es" ? "Freelance / Disponible para contratación" : "Freelance / Available for hire",
            },
            makesOffer: [
              {
                "@type": "Offer",
                itemOffered: {
                  "@type": "Service",
                  name: lang === "es" ? "Desarrollo de aplicaciones web con Laravel" : "Laravel web application development",
                  description:
                    lang === "es"
                      ? "Desarrollo de aplicaciones web robustas y escalables con Laravel y PHP. APIs REST, integraciones y optimización de rendimiento."
                      : "Development of robust and scalable web applications with Laravel and PHP. REST APIs, integrations, and performance optimization.",
                  provider: {
                    "@id": "https://www.ignathedev.com/#person",
                  },
                  areaServed: {
                    "@type": "Country",
                    name: "Worldwide",
                  },
                  availableChannel: {
                    "@type": "ServiceChannel",
                    serviceType: "Remote",
                  },
                },
              },
              {
                "@type": "Offer",
                itemOffered: {
                  "@type": "Service",
                  name: lang === "es" ? "Desarrollo Frontend con Vue.js" : "Frontend development with Vue.js",
                  description:
                    lang === "es"
                      ? "Interfaces de usuario modernas y reactivas con Vue.js y TailwindCSS. Diseño responsive y optimización de rendimiento."
                      : "Modern and reactive user interfaces with Vue.js and TailwindCSS. Responsive design and performance optimization.",
                  provider: {
                    "@id": "https://www.ignathedev.com/#person",
                  },
                  areaServed: {
                    "@type": "Country",
                    name: "Worldwide",
                  },
                  availableChannel: {
                    "@type": "ServiceChannel",
                    serviceType: "Remote",
                  },
                },
              },
              {
                "@type": "Offer",
                itemOffered: {
                  "@type": "Service",
                  name: lang === "es" ? "Desarrollo Full Stack" : "Full Stack Development",
                  description: lang === "es" ? "Soluciones web completas de principio a fin. Desde el diseño hasta el despliegue y mantenimiento." : "Complete end-to-end web solutions. From design to deployment and maintenance.",
                  provider: {
                    "@id": "https://www.ignathedev.com/#person",
                  },
                  areaServed: {
                    "@type": "Country",
                    name: "Worldwide",
                  },
                  availableChannel: {
                    "@type": "ServiceChannel",
                    serviceType: "Remote",
                  },
                },
              },
            ],
          },
          {
            "@type": "ItemList",
            "@id": "https://www.ignathedev.com/#skills",
            name: lang === "es" ? "Habilidades Técnicas" : "Technical Skills",
            itemListElement: [
              ...professionalProfile.skills.programming.map((skill, index) => ({
                "@type": "ListItem",
                position: index + 1,
                item: {
                  "@type": "DefinedTerm",
                  name: skill,
                  description: `${skill} programming`,
                },
              })),
              ...professionalProfile.skills.frameworks.map((skill, index) => ({
                "@type": "ListItem",
                position: professionalProfile.skills.programming.length + index + 1,
                item: {
                  "@type": "DefinedTerm",
                  name: skill,
                  description: `${skill} framework/library`,
                },
              })),
            ],
          },
        ],
      })}
    />
    <!-- hreflang for international SEO -->
    <link rel="alternate" hreflang="es" href={spanishUrl} />
    <link rel="alternate" hreflang="es-ES" href={spanishUrl} />
    <link rel="alternate" hreflang="en" href={englishUrl} />
    <link rel="alternate" hreflang="en-US" href={englishUrl} />
    <link rel="alternate" hreflang="x-default" href={englishUrl} />

    <!-- Preload critical fonts -->
    <link
      rel="preload"
      href="/fonts/Inter-Regular.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/fonts/Inter-Bold.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />

    <!-- Favicon and app icons -->
    <link
      rel="icon"
      href="/favicon.ico"
    />
    <link
      rel="apple-touch-icon"
      href="/apple-touch-icon.png"
    />
    <link
      rel="manifest"
      href="/manifest.json"
    />

    <!-- BreadcrumbList Schema for better navigation in search results -->
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        itemListElement: [
          {
            "@type": "ListItem",
            position: 1,
            name: lang === "es" ? "Inicio" : "Home",
            item: lang === "es" ? "https://www.ignathedev.com" : "https://www.ignathedev.com/en",
          },
          ...(isBlogPage
            ? [
                {
                  "@type": "ListItem",
                  position: 2,
                  name: "Blog",
                  item: lang === "es" ? "https://www.ignathedev.com/blog" : "https://www.ignathedev.com/en/blog",
                },
              ]
            : []),
          ...(!isHomePage && !isBlogPage
            ? [
                {
                  "@type": "ListItem",
                  position: 2,
                  name: metaTitle,
                  item: `https://www.ignathedev.com${currentPath}`,
                },
              ]
            : []),
        ],
      })}
    />

    <!-- Professional Service Schema -->
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "ProfessionalService",
        "@id": "https://www.ignathedev.com/#business",
        name: lang === "es" ? "Ignacio Amat - Servicios de Desarrollo Web" : "Ignacio Amat - Web Development Services",
        image: ogImage,
        url: "https://www.ignathedev.com",
        description:
          lang === "es"
            ? "Servicios profesionales de desarrollo web. Especializado en crear aplicaciones web y sitios web de alto rendimiento con PHP, Laravel y Vue.js. Disponible para trabajo remoto."
            : "Professional web development services. Specialized in creating high-performance web applications and websites with PHP, Laravel, and Vue.js. Available for remote work.",
        priceRange: "$$",
        availableLanguage: ["es", "en"],
        serviceType: "Web Development",
        areaServed: [
          {
            "@type": "Country",
            name: "Spain",
          },
          {
            "@type": "AdministrativeArea",
            name: "European Union",
          },
          {
            "@type": "Place",
            name: "Worldwide (Remote)",
          },
        ],
        hasOfferCatalog: {
          "@type": "OfferCatalog",
          name: lang === "es" ? "Servicios de Desarrollo Web" : "Web Development Services",
          itemListElement: [
            {
              "@type": "Offer",
              itemOffered: {
                "@type": "Service",
                name: lang === "es" ? "Desarrollo Full Stack" : "Full Stack Development",
                description: lang === "es" ? "Desarrollo completo de aplicaciones web desde el frontend hasta el backend" : "Complete web application development from frontend to backend",
              },
            },
            {
              "@type": "Offer",
              itemOffered: {
                "@type": "Service",
                name: lang === "es" ? "Desarrollo Laravel" : "Laravel Development",
                description: lang === "es" ? "Aplicaciones web robustas y escalables con el framework Laravel" : "Robust and scalable web applications with Laravel framework",
              },
            },
            {
              "@type": "Offer",
              itemOffered: {
                "@type": "Service",
                name: lang === "es" ? "Desarrollo Vue.js" : "Vue.js Development",
                description: lang === "es" ? "Interfaces de usuario modernas y reactivas con Vue.js" : "Modern and reactive user interfaces with Vue.js",
              },
            },
            {
              "@type": "Offer",
              itemOffered: {
                "@type": "Service",
                name: lang === "es" ? "Consultoría Web" : "Web Consulting",
                description: lang === "es" ? "Asesoramiento técnico para proyectos web y optimización de rendimiento" : "Technical advice for web projects and performance optimization",
              },
            },
          ],
        },
        sameAs: Object.values(professionalProfile.socialProfiles),
      })}
    />
  </head>
  <body class="bg-white dark:bg-gray-900">
    <div class="absolute top-0 z-[-2] h-screen w-screen bg-gradient-to-br from-gray-50 to-white dark:from-gray-900 dark:to-gray-800"></div>

    <div class="relative min-h-screen flex flex-col z-10">
      {lang === "es" ? <Header /> : <HeaderEnglish />}

      <main class="flex-1">
        <slot />
      </main>

      {lang === "es" ? <Footer /> : <FooterEnglish />}
    </div>
  </body>
</html>
<style lang="scss">
  @use "webcoreui/styles" as *;
  @include setup(
    (
      fontRegular: "/fonts/Inter-Regular.woff2",
      fontBold: "/fonts/Inter-Bold.woff2",
    )
  );
</style>
<style is:global>
  :root {
    color-scheme: dark light;
  }

  html {
    font-family: "Onest Variable", system-ui, sans-serif;
    scroll-behavior: smooth;
    margin: 0;
    padding: 0;
  }

  body {
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    background-color: white;
    min-height: 100vh;
    position: relative;
  }

  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
  }

  /* Hide scrollbar for social pills container but keep functionality */
  .social-pills-container {
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
    padding: 0.5rem; /* Add padding to prevent pills from being clipped on hover */
    width: 100%; /* Adjust width to account for padding */
  }

  .social-pills-container::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }

  /* Update existing styles */
  .hero-section {
    position: relative;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding-left: 1rem;
    padding-right: 1rem;
    z-index: 1;
  }

  /* Responsive text sizing for smaller devices (solo contenido main, no el header) */
  @media (max-width: 640px) {
    main h1 {
      font-size: 1.75rem !important;
    }
    main h2 {
      font-size: 1.25rem !important;
    }
    .hero-section {
      padding-bottom: 5rem;
    }
  }

  /* Create some space between sections */
  #expertise {
    padding-top: 3rem;
    scroll-margin-top: 2rem;
  }

  main {
    position: relative;
  }

  /* Center all main content */
  main {
    width: 100%;
  }
</style>
